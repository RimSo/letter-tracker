<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Letter Tracker</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
      .row-completed { opacity: 0.6; }
      .tab-badge { font-weight: 600; }
      .clip { max-width: 220px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display:inline-block; vertical-align: middle;}
      .table-fixed { table-layout: fixed; }
      .truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .small-pad td, .small-pad th { padding-top: .5rem; padding-bottom: .5rem; }
      .total-label { font-size: .9rem; color: #666; }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        padding-top: 60px; /* Adjust based on your navbar height */
      }

      main {
        flex: 1;
      }
    </style>
  </head>

  <body class="bg-light">

   <!-- SINGLE NAVBAR (fixed) -->
<nav class="navbar navbar-light bg-white border-bottom px-3 fixed-top">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <!-- LEFT: Logo + Title -->
    <a class="navbar-brand fw-semibold d-flex align-items-center" href="{{ url_for('index') }}">
      <div style="
          width:34px;height:34px;overflow:hidden;border-radius:6px;
          display:flex;align-items:center;justify-content:center;">
        <img src="{{ url_for('static', filename='logo.png') }}"
             style="height:100%;width:auto;">
      </div>
      <span class="ms-2 fs-5">Letter Tracker</span>
    </a>

   <!-- RIGHT SIDE: Search + User Dropdown -->
<div class="d-flex align-items-center gap-3 ms-auto">

    {% if current_user.is_authenticated
       and not request.path.startswith('/admin')
       and request.endpoint not in [
            'login', 'register', 'forgot_password',
            'reset_password', 'verify_email'
       ]
    %}

    <!-- SEARCH BAR (RIGHT) -->
    <div class="position-relative" style="width:260px;">
        <form id="searchForm" method="get" action="{{ url_for('index') }}">

            <i class="bi bi-search position-absolute"
               style="left:10px; top:50%; transform:translateY(-50%); color:#888;"></i>

            <input type="text"
                   id="searchInput"
                   name="q"
                   autocomplete="off"
                   value="{{ request.args.get('q','') }}"
                   placeholder="Search letters‚Ä¶"
                   class="form-control ps-5 pe-5">

            <button type="button"
                    id="clearSearch"
                    class="btn position-absolute"
                    style="right:5px; top:50%; transform:translateY(-50%);
                           background:transparent; border:none;
                           opacity:0; transition:opacity .25s;">
                <i class="bi bi-x-lg text-muted"></i>
            </button>

            <div id="autocompleteBox"
                 class="list-group position-absolute w-100 shadow-sm"
                 style="top:110%; z-index:1000; display:none; max-height:200px; overflow-y:auto;">
            </div>

        </form>
    </div>
    {% endif %}
</div>

      <!-- USER DROPDOWN -->
      {% if current_user.is_authenticated %}
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center text-decoration-none"
           id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <div class="rounded-circle overflow-hidden bg-light border"
               style="width:34px; height:34px;">
            <img src="{{ url_for('static', filename='avatars/' + (current_user.avatar_path or 'default.png')) }}"
                 class="rounded-circle"
                 style="width:32px;height:32px;object-fit:cover;">
          </div>
          <span class="ms-2 fw-semibold d-none d-md-inline">{{ current_user.name }}</span>
        </a>

        <ul class="dropdown-menu dropdown-menu-end shadow">

  <!-- PROFILE -->
  <li>
    <a class="dropdown-item" href="{{ url_for('profile') }}">
      üë§ Profile
    </a>
  </li>

  <!-- ADMIN (only visible for admins) -->
  {% if current_user.is_admin %}
  <li>
    <a class="dropdown-item" href="{{ url_for('admin_dashboard') }}">
      üõ†Ô∏è Admin
    </a>
  </li>
  {% endif %}

  <li><hr class="dropdown-divider"></li>

  <!-- LOGOUT -->
  <li>
    <a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
      ‚èª Logout
    </a>
  </li>

</ul>
      {% endif %}

    </div>
  </div>
</nav>
    <!-- END NAVBAR -->

    <!-- Flash messages -->
    <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mt-2">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
    </div>

    <!-- Page Content -->
    <main class="container py-4">
      {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Password toggle -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('[data-toggle-password]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            const targetId = btn.getAttribute('data-toggle-password');
            const input = document.getElementById(targetId);
            if (!input) return;
            if (input.type === 'password') {
              input.type = 'text';
              btn.textContent = 'Hide';
            } else {
              input.type = 'password';
              btn.textContent = 'Show';
            }
          });
        });
      });
    </script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("searchInput");
  const clearBtn = document.getElementById("clearSearch");
  const autoBox = document.getElementById("autocompleteBox");
  const searchForm = document.getElementById("searchForm");

  // üî• Show clear button only if input has text
  function updateClear() {
    if (input.value.length > 0) {
      clearBtn.style.opacity = 1;
      clearBtn.style.pointerEvents = "auto";
    } else {
      clearBtn.style.opacity = 0;
      clearBtn.style.pointerEvents = "none";
    }
  }
  updateClear();

  // üî• Clear search with fade animation
  clearBtn.onclick = () => {
    input.value = "";
    updateClear();
    autoBox.style.display = "none";

    // Smooth fade-out effect
    input.style.transition = "opacity 0.2s";
    input.style.opacity = 0.2;
    setTimeout(() => {
      input.style.opacity = 1;
      window.location = "{{ url_for('index') }}";
    }, 150);
  };

  // üî• Keyboard shortcut "/" focuses search
  document.addEventListener("keydown", (e) => {
    if (e.key === "/" && document.activeElement !== input) {
      e.preventDefault();
      input.focus();
    }
  });

  // üî• Autocomplete live suggestions
  input.addEventListener("input", async () => {
    updateClear();
    let q = input.value.trim();
    if (!q) {
      autoBox.innerHTML = "";
      autoBox.style.display = "none";
      return;
    }

    // Request autocomplete results
    const res = await fetch(`/autocomplete?q=${encodeURIComponent(q)}`);
    const items = await res.json();

    // Build dropdown
    if (items.length > 0) {
      autoBox.innerHTML = items
        .map(i => `
            <button type="button" class="list-group-item list-group-item-action"
                    onclick="document.getElementById('searchInput').value='${i}'; document.getElementById('searchForm').submit();">
                ${i}
            </button>
        `).join("");
      autoBox.style.display = "block";
    } else {
      autoBox.style.display = "none";
    }
  });

  // Hide autocomplete if clicking outside
  document.addEventListener("click", (e) => {
    if (!autoBox.contains(e.target) && e.target !== input) {
      autoBox.style.display = "none";
    }
  });
});
</script>

  <script>
document.addEventListener("DOMContentLoaded", function () {
    var t = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    t.forEach(function (el) {
        new bootstrap.Tooltip(el);
    });
});
</script>

  <footer class="bg-dark text-light mt-5">
    <div class="container py-4">
      <div class="row">
        <div class="col-md-6">
          <h5>Letter Tracker</h5>
          <p class="text-white">Track and manage your letters efficiently</p>
        </div>
        <div class="col-md-6 text-md-end">
          <p class="mb-0 text-white">&copy; 2025 All rights reserved.</p>
        </div>
      </div>
    </div>
  </footer>



  </body>
</html>